{% extends "base.html" %}
{% block content %}
<h2>
    比數：{{ team_score }} ：{{ opponent_score }}<br>
    <span style="font-size:1.2em;">我方 vs {{ opponent }}</span>
</h2>
<hr>
<h2>第 {{ inning }} 局{{ '上' if is_top else '下' }}｜出局數：{{ outs }}</h2>
<h3>第 {{ order + 1 }} 棒 - {{ batter.name }}</h3>
<form method="post" id="atbat_form">
    <label>打擊結果：</label>
    <select name="result_select" required>
        {% for r in result_types %}
        <option value="{{ r }}">{{ r }}</option>
        {% endfor %}
    </select>

    <input type="hidden" name="result" id="real_result" value="">

    <br><br>
    <label>打點 (RBI)：</label>
    <input type="number" name="rbis" min="0" value="0">
    <br><br>

    <button type="submit" onclick="document.getElementById('real_result').value = document.querySelector('select[name=result_select]').value;">確定送出</button>
    <button type="button" onclick="
        document.getElementById('real_result').value = 'RUNNER_OUT';
        document.getElementById('atbat_form').submit();
    ">跑者出局
    </button>
</form>
<!-- 球員換人：通常是跳到更換球員頁 -->
<form action="{{ url_for('switch_player', game_id=game_id, order=order) }}" style="display:inline; margin-right:8px;">
  <button type="submit">球員換人</button>
</form>

<!-- 復原上一筆：導向 undo_atbat route -->
<form action="{{ url_for('undo_atbat', game_id=game_id, order=order, inning=inning) }}" style="display:inline; margin-right:8px;">
  <button type="submit">復原上一筆</button>
</form>

<!-- 返回首頁：通常導向 index -->
<form action="{{ url_for('index') }}" style="display:inline;">
  <button type="submit">返回首頁</button>
</form>


{% if outs >= 3 %}
    <p style="color:blue;font-weight:bold;">三出局，自動切換介面。</p>
    <script>
    setTimeout(function(){
        {% if is_top %}
            window.location = "{{ url_for('record_defense', game_id=game_id, inning=inning, is_top=False) }}";
        {% else %}
            window.location = "{{ url_for('record_defense', game_id=game_id, inning=inning+1, is_top=True) }}";
        {% endif %}
    }, 1200)
    </script>
{% endif %}

<form action="{{ url_for('finish_record', game_id=game_id) }}" method="post">
    <button type="submit" style="background:#28a745;color:white;font-size:16px;">完成紀錄</button>
</form>
{% endblock %}


